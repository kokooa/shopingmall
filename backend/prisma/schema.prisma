// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}


// 1. ê¸°ì¡´ User ëª¨ë¸ì— ì•„ë˜ í•œ ì¤„ ì¶”ê°€ (ë‚´ ì¥ë°”êµ¬ë‹ˆ ì—°ê²°)
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())

  orders Order[]
  role      String    @default("USER")
  cart      Cart?    // ğŸ‘ˆ ì¶”ê°€: ìœ ì €ëŠ” ì¥ë°”êµ¬ë‹ˆë¥¼ ê°€ì§ˆ ìˆ˜ë„, ì•ˆ ê°€ì§ˆ ìˆ˜ë„ ìˆìŒ (1:1)
}

// 2. ê¸°ì¡´ Product ëª¨ë¸ì— ì•„ë˜ í•œ ì¤„ ì¶”ê°€ (ëˆ„êµ°ê°€ì˜ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¹€)
model Product {
  id          Int      @id @default(autoincrement())
  name        String
  price       Int
  category    String
  imageUrl    String
  description String?
  createdAt   DateTime @default(now())

  orderItems OrderItem[]
  cartItems   CartItem[] // ğŸ‘ˆ ì¶”ê°€: ì´ ìƒí’ˆì€ ì—¬ëŸ¬ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸¸ ìˆ˜ ìˆìŒ (1:N)
}

// ==========================================
// ğŸ‘‡ 3. ì•„ë˜ ëª¨ë¸ë“¤ì„ íŒŒì¼ ë§¨ ë°‘ì— ìƒˆë¡œ ì¶”ê°€í•˜ì„¸ìš”
// ==========================================

// ì¥ë°”êµ¬ë‹ˆ (ìœ ì €ë‹¹ 1ê°œ)
model Cart {
  id        Int        @id @default(autoincrement())
  userId    Int        @unique // â­ ìœ ì € í•œ ëª…ë‹¹ ì¥ë°”êµ¬ë‹ˆëŠ” í•˜ë‚˜ë§Œ (Unique)
  user      User       @relation(fields: [userId], references: [id])
  items     CartItem[] // ì¥ë°”êµ¬ë‹ˆ ì•ˆì— ë‹´ê¸´ ì•„ì´í…œë“¤
  updatedAt DateTime   @updatedAt // ë§ˆì§€ë§‰ìœ¼ë¡œ ìˆ˜ì •í•œ ì‹œê°„
}

// ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ (ì–´ë–¤ ìƒí’ˆì„ ëª‡ ê°œ ë‹´ì•˜ëŠ”ì§€)
model CartItem {
  id        Int      @id @default(autoincrement())
  
  // ì–´ëŠ ì¥ë°”êµ¬ë‹ˆ ì†Œì†ì¸ì§€
  cartId    Int
  cart      Cart     @relation(fields: [cartId], references: [id])

  // ë¬´ìŠ¨ ìƒí’ˆì¸ì§€
  productId Int
  product   Product  @relation(fields: [productId], references: [id])

  // ëª‡ ê°œ ë‹´ì•˜ëŠ”ì§€
  quantity  Int      @default(1)

  createdAt DateTime @default(now())
}

// 1. ì£¼ë¬¸ (ì˜ìˆ˜ì¦ ì—­í• )
model Order {
  id            Int         @id @default(autoincrement())
  userId        Int
  user          User        @relation(fields: [userId], references: [id])
  
  orderItems    OrderItem[] // ì£¼ë¬¸í•œ ìƒí’ˆ ëª©ë¡
  
  totalAmount   Int         // ì´ ê²°ì œ ê¸ˆì•¡
  status        OrderStatus @default(PENDING) // ì£¼ë¬¸ ìƒíƒœ (ëŒ€ê¸°, ì™„ë£Œ, ì·¨ì†Œ ë“±)
  
  // ê²°ì œ ê´€ë ¨ ì •ë³´ (í¬íŠ¸ì› ì—°ë™ìš©)
  merchantUid   String      @unique // ì£¼ë¬¸ ë²ˆí˜¸ (ìš°ë¦¬ê°€ ë§Œë“  ê³ ìœ  ID)
  impUid        String?     // í¬íŠ¸ì› ê²°ì œ ê³ ìœ  ID (ê²°ì œ ì„±ê³µ ì‹œ ì €ì¥)
  
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

// 2. ì£¼ë¬¸ ìƒì„¸ ì•„ì´í…œ (ì˜ìˆ˜ì¦ ì„¸ë¶€ ë‚´ì—­)
model OrderItem {
  id        Int      @id @default(autoincrement())
  orderId   Int
  order     Order    @relation(fields: [orderId], references: [id])
  
  productId Int
  product   Product  @relation(fields: [productId], references: [id])
  
  quantity  Int      // ì£¼ë¬¸ ìˆ˜ëŸ‰
  price     Int      // êµ¬ë§¤ ë‹¹ì‹œ ê°€ê²© (ìƒí’ˆ ê°€ê²©ì´ ë‚˜ì¤‘ì— ë³€í•´ë„ ì´ê±´ ê³ ì •ë˜ì–´ì•¼ í•¨!)
}

// 3. ì£¼ë¬¸ ìƒíƒœ Enum (ì˜¤íƒ€ ë°©ì§€)
enum OrderStatus {
  PENDING   // ê²°ì œ ëŒ€ê¸°
  PAID      // ê²°ì œ ì™„ë£Œ
  SHIPPED   // ë°°ì†¡ ì¤‘
  DELIVERED // ë°°ì†¡ ì™„ë£Œ
  CANCELLED // ì£¼ë¬¸ ì·¨ì†Œ
}